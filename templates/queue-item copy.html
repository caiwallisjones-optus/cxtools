{% extends 'base.html' %}

{% macro renderHooActionsInTable(arg1) %}
{% set list = arg1.split('|') %}
{% for element in list %}
            <div class="form-group form-inline">
              <label for="queue_item_prequeueaction_remove">{{element}}</label>
              <input type="hidden" name="queue_item_prequeueaction_remove" value="{{element}}" ></input>
              <button type="submit" class="form-control btn btn-primary btn-sm pull-right" name="action"
                value="queue_item_prequeueaction_remove">Remove</button>
            </div>
{%endfor%}
{% endmacro %}

{% block content %}
  {% if item == None %}
  <h2>New Queue</h2>
  {%else%}
  <h2>Edit Queue</h2>
  {% endif %} {# End Page title #}
    <!--header for queue information-->
    {% if errMsg%}
      <!--We had an error the last time we told the user to do this - display and retry-->
    <p class="justify-content-lg-center btn-warning">{{errMsg}}</p>
    {% endif %}  {# End Error msg #}
    <form method='post' action="{{url_for('queues')}}">
      <div>
        <input type="hidden" name="id" value="{{ item[0] }}" ></input>
        <input type="hidden" name="attachedskills" value="{{ item[3] }}" ></input>
      </div>
      <div class="form-group">
        <label for="name">Queue Name:</label>
        <input type="text" class="form-control" id="name" name="name" value = "{{item[2]}}">
      </div>
      <div class="panel panel-default clearfix">
        <div class="panel-heading clearfix form-inline">Attached Skill(s):
          <div class="pull-right">
          <select class="form-control gap-3" id="new_skill" name="new_skill">
            <option value="">*None*</option>
            {%for skill in skillList %}
            <option value="{{skill[0]}}">{{skill[5]}}</option>
            {%endfor%}
          </select>
          <button type="submit" class="form-control btn btn-primary btn-sm" name="action"
              value="queue_item_skill_new">  Add  </button>
        </div>
        </div>
        <div class="panel-body">
        {%if item[3] == '' or item is undefined %}**Select and add new skill**
        {%else%}
          {%for skill in skillList %}
          {%if ("," + skill[0]|string + ",") in item[3]%}
          <form method="post" >
          <div class="form-group form-inline">
            <label for="skill_remove">{{skill[5]}}</label>
            <input type="hidden" name="skill_remove" value="{{ skill[0] }}" ></input>
            <button type="submit" class="form-control btn btn-primary btn-sm pull-right" name="action"
              value="queue_item_skill_remove">Remove</button>
          </div>
          </form>
          {%endif%}
          {%endfor%}
        {%endif%}
        </div>
      </div>
      <!--
      <div class="form-group">
        <label for="attachedskills">Attached Skills:</label>
        <input type="text" class="form-control" id="attachedskills" name="attachedskills" value = "{{item[3]}}">
      </div>
      -->
      <div class="form-group">

        <label for="hoo">Queue hours of operation:</label>
        <!--<input type="text" class="form-control" id="hoo" name="hoo">-->
        <select class="form-control" id="hoo" name="hoo">
          <option value="">*No override*</option>
          {%for hoo in hooList %}
          <option value="{{hoo[0]}}" {%if item[4] == hoo[0]%}selected = "selected" {%endif%} >{{hoo[4]}}</option>
          {%endfor%}
        </select>&nbsp;
      </div>
      <div class="form-group">
        <div class="panel panel-default clearfix">
          <div class="panel-heading clearfix form-inline">Hours of operation checks prior to queueing:
            <div class="pull-right">
            <select class="form-control gap-3" id="preQueueState" name="preQueueState" >
              <option value="Closed">Closed</option>
              <option value="Emergency">Emergency</option>
              <option value="Meeting">Meeting</option>
              <option value="Holiday">Holiday</option>
              <option value="Weather">Weather</option>
              <option value="Other">Other</option>
              <option value="Open">Open</option>
              <option value="Unattended">Unattended</option>
            </select>
            <select class="form-control gap-3"  id="preQueueStateAction" name="preQueueStateAction">
              <option value="HANGUP">Play Message and hang up</option>
              <option value="VOICEMAIL">Play message and then force to voicemail</option>
              <option value="VOICEMAILOPT">Offer Voicemail then continue</option>
              <option value="TRANSFER">Transfer call to number (E164)</option>
              <option value="PLAY">Play a message and continue</option>
              <option value="CALLBACK">Force a callback for this time</option>
              <option value="CUSTOMEVENT">Custom parameters provided by Optus engineering</option>
              <option value="Unattended">Unattended</option>
            </select>
            <input type="text" class="form-control" id="preQueueStateParams" name="preQueueStateParams" value = "<Action Details>">
            <button type="submit" class="form-control btn btn-primary btn-sm" name="action"
                value="queue_item_prequeueaction_new">  Add  </button>
          </div>
          </div>
          <div class="panel-body">
          {%if item == None or item is not defined%}**Before entering queue check options for skill based hours of operation**
          {%else %}{{ renderHooActionsInTable(item[5])}}
          {% endif %}
          </div>
        </div>
        <div class="panel panel-default clearfix">
          <div class="panel-heading clearfix form-inline">Hours of operation checks whilst call is queueing:
            <div class="pull-right">
            <select class="form-control gap-3"
              <option value="Closed">Closed</option>
              <option value="Emergency">Emergency</option>
              <option value="Meeting">Meeting</option>
              <option value="Holiday">Holiday</option>
              <option value="Weather">Weather</option>
              <option value="Other">Other</option>
              <option value="Open">Open</option>
              <option value="Unattended">Unattended</option>
            </select>
            <select class="form-control gap-3">
              <option value="HANGUP">Play Message and hang up</option>
              <option value="VOICEMAIL">Play message and then force to voicemail</option>
              <option value="VOICEMAILOPT">Offer Voicemail then continue</option>
              <option value="TRANSFER">Transfer call to number (E164)</option>
              <option value="PLAY">Play a message and continue</option>
              <option value="CALLBACK">Force a callback for this time</option>
              <option value="CUSTOMEVENT">Custom parameters provided by Optus engineering</option>
              <option value="Unattended">Unattended</option>
            </select>
            <input type="text" class="form-control" id="param" name="param" value = "<Action Details>">
            <button type="submit" class="form-control btn btn-primary btn-sm" name="action"
                value="queue_item_queueaction_new">  Add  </button>
          </div>
          </div>
          <div class="panel-body">
          {%if item == None or item is undefined%}**If we need to periodically check HOO state during the time call is in queue add here**
          {%else %}{{ renderHooActionsInTable(item[6])}}
          {% endif %}
            <div class="form-group form-inline">
              <label for="skill_remove">{{skill[6]}}</label>
              <input type="hidden" name="skill_remove" value="{{ skill[0] }}" ></input>
              <button type="submit" class="form-control btn btn-primary btn-sm pull-right" name="action"
                value="queue_item_queueaction_remove">Remove</button>
            </div>

          </div>
        </div>
      </div>
      <div class = "pull-right">
        <div class="btn-group btn-group-med">
          <button type="submit" class="btn btn-primary btn-med px-4 gap-3 pull-right" name = "action" value="queue_cancel">Cancel</button>
        </div>  
        <div class="btn-group btn-group-med">
          {% if item == None or item is undefined %}
          <button type="submit" class="btn btn-primary btn-med px-4 gap-3 pull-right" name = "action" value="queue_new">Create</button>
          {%else%}
          <button type="submit" class="btn btn-primary btn-med px-4 gap-3 pull-right" name = "action" value="queue_update">Update</button>
          {%endif%}
        </div>
        </div>  
    </form>
    {% if queue != None %}
    <br>
  <br>  
  {% if item != None %}
  <div class="container">
    <div class="table-responsive">
      <table class="table table-bordered table-hover table-striped">
        <thead>
          <tr>
            <th>Queue Action</th>
            <th>Parameter 1</th>
            <th>Parameter 2</th>
            <th>Actions</th>
          </tr>
        </thead>
      </tbody>
      <br>
      {% for item in actions %}
      <form method="post" >
      <tr>
        <input type="hidden" name="action_id" value="{{ item[0] }}">
        <input type="hidden" name="queue_id" value="{{ item[1] }}">
        <td>{{item[2]}}</td>
        <td>{{item[3]}}</td>
        <td>{{item[4]}}</td>
        <td>
          <button type="submit" class="btn btn-link" name="action" value="queue_action_up">
            <span class="glyphicon glyphicon-menu-up"></span>
          </button>
          <button type="submit" class="btn btn-link"  name="action" value="queue_action_down">
            <span class="glyphicon glyphicon-menu-down"></span>
          </button>
          <button type="submit" class="btn btn-link"  name="action" value="queue_action_delete">
            <span class="glyphicon glyphicon-trash"></span>
          </button>
          <button type="submit" class="btn btn-link"  name="action" value="queue_action_edit">
            <span class="glyphicon glyphicon-pencil"></span>
          </button>
        </td>
      </tr>
    </form>
    
    {% endfor %}
    {% endif %}
  </tbody>
  </table>
  {% if item is not none %}
  <form method='post' action="{{url_for('queues')}}">
    <div class="d-grid gap-2 d-sm-flex justify-content-sm-center my-2">
      <div>
        <input type="hidden" name="id" value="{{ item[0] }}" ></input>
      </div>
      <button type="submit" class="btn btn-primary btn-sm px-4 gap-3  pull-right" name="action" value="queue_action_new">Add Action</button>
    </div>  
</form>
{%endif%}
</div>
  </div>
  {%endif%}
<br>
{% endblock %}


      